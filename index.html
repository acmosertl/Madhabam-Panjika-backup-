<!DOCTYPE html>
<html lang="bn">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ржорж╛ржзржмржо ржкржЮрзНржЬрж┐ржХрж╛ тАУ vC1.1</title>
<style>
  :root{
    --bg:#FFF1D6; --radius:16px; --shadow:0 2px 10px rgba(0,0,0,.14);
    --pink:#F79AD3; --red:#C62828;
    --deepBlue1:#1e3a8a; --deepBlue2:#0d1b4c;
    --ink:#111; --white:#fff;
    --labelPurple:#5b2299; /* тЬЕ Deep Purple labels */
    --gold:#FFD700;        /* тЬЕ Ekadashi name */
  }
  *{box-sizing:border-box}
  body{margin:0;background:var(--bg);font-family:"Noto Sans Bengali",system-ui,sans-serif;padding:16px;color:var(--ink)}
  .panel{background:#fff;border-radius:var(--radius);box-shadow:var(--shadow);padding:12px 14px;margin:0 auto 14px;max-width:720px}
  .title{font-weight:800;text-align:center;margin:.2rem 0 .6rem}

  /* ЁЯкФ ржкржЮрзНржЬрж┐ржХрж╛ */
  .panchika{background:#fff}
  .panchika .title{color:#5c2f00}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .full{grid-column:1/-1}
  .cell{background:var(--pink);border-radius:12px;padding:10px;box-shadow:inset 0 0 0 1px rgba(255,255,255,.35), 0 3px 10px rgba(0,0,0,.06)}
  .label{
    /* тЬЕ рж╣рж▓рзБржж ржмрзНржпрж╛ржХржЧрзНрж░рж╛ржЙржирзНржб ржирзЗржЗ, ржбрж┐ржк ржкрж╛рж░рзНржкрж▓ ржмрзЛрж▓рзНржб ржЯрзЗржХрзНрж╕ржЯ */
    color:var(--labelPurple); font-weight:900; font-size:16px;
    display:inline-block; padding:0; margin:0 0 6px 0
  }
  .value{font-weight:800;font-size:22px;color:#000}

  /* ЁЯУЕ Popup trigger */
  .trigger{background:#FFF8E1;color:#7B1FA2;text-align:center;border-radius:12px;padding:12px;font-weight:800;box-shadow:0 2px 6px rgba(0,0,0,.2);cursor:pointer}
  .trigger:hover{filter:brightness(1.05)}

  /* ЁЯМ╝ ржПржХрж╛ржжрж╢рзА */
  .eka{background:var(--red);color:var(--white);text-align:center}
  .eka .title{margin:.2rem 0 .2rem}
  .eka .name{
    /* тЬЕ рж╕рзЛржирж╛рж▓рж┐, ржмржбрж╝, ржЧрзНрж▓рзЛ */
    color:var(--gold); font-size:1.9rem; font-weight:900;
    text-shadow:0 0 10px rgba(255,215,0,.9), 0 0 18px rgba(255,215,0,.6)
  }
  .eka .meta{opacity:.98;margin-top:4px}
  .eka .dot{font-weight:900; font-size:1.15em; padding:0 .25em}

  /* ЁЯУг ржЖрж╕ржирзНржи ржЙрзОрж╕ржм */
  .fest{background:#fff59d;color:#b71c1c;text-align:center}
  .fest .name{font-weight:900;font-size:1.2rem}
  .fest .meta{opacity:.95}

  /* ЁЯМК ржЬрзЛржпрж╝рж╛рж░-ржнрж╛ржЯрж╛ */
  .tide{background:linear-gradient(to bottom,var(--deepBlue1),var(--deepBlue2));color:#fff}
  .tide .title{color:#fff}
  .tide-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  .tide-cell{background:rgba(255,255,255,.12);border:1px solid rgba(255,255,255,.28);border-radius:12px;padding:10px}
  .tide-row{display:flex;justify-content:space-between;gap:8px}
  .tide-label{font-weight:800}
  .tide-val{font-weight:800}

  .icon{font-size:1.3em;text-shadow:0 0 9px rgba(255,255,255,.85)}
</style>
</head>
<body>

  <!-- 1) ЁЯкФ ржкржЮрзНржЬрж┐ржХрж╛ -->
  <section class="panel panchika">
    <div class="title">ЁЯкФ ржкржЮрзНржЬрж┐ржХрж╛</div>

    <!-- тЬЕ рждрж┐ржерж┐ ржлрзБрж▓-ржЙржЗржбрже -->
    <div class="cell full">
      <div class="label">рждрж┐ржерж┐</div>
      <div id="tithi" class="value">тАФ</div>
    </div>

    <!-- тЬЕ ржиржХрзНрж╖рждрзНрж░ ржлрзБрж▓-ржЙржЗржбрже -->
    <div class="cell full" style="margin-top:10px">
      <div class="label">ржиржХрзНрж╖рждрзНрж░</div>
      <div id="nakshatra" class="value">тАФ</div>
    </div>

    <!-- рж╕рзВрж░рзНржп/ржЪржирзНржжрзНрж░ 2├Ч2 рж╕ржорж╛ржи ржЧрзНрж░рж┐ржб -->
    <div class="grid2" style="margin-top:10px">
      <div class="cell">
        <div class="label">рж╕рзВрж░рзНржпрзЛржжржпрж╝</div>
        <div id="sunrise" class="value">тАФ</div>
      </div>
      <div class="cell">
        <div class="label">рж╕рзВрж░рзНржпрж╛рж╕рзНржд</div>
        <div id="sunset" class="value">тАФ</div>
      </div>
      <div class="cell">
        <div class="label">ржЪржирзНржжрзНрж░рзЛржжржпрж╝</div>
        <div id="moonrise" class="value">тАФ</div>
      </div>
      <div class="cell">
        <div class="label">ржЪржирзНржжрзНрж░рж╛рж╕рзНржд</div>
        <div id="moonset" class="value">тАФ</div>
      </div>
    </div>
  </section>

  <!-- 2) ЁЯУЕ рж╕ржорзНржкрзВрж░рзНржг ржкржЮрзНржЬрж┐ржХрж╛ ржЯрзНрж░рж┐ржЧрж╛рж░ -->
  <section class="panel trigger" id="calendarTrigger" data-popup="madhabam-fullcalendar" data-href="/calendar">
    ЁЯУЕ рж╕ржорзНржкрзВрж░рзНржг рж╣рж┐ржирзНржжрзБ ржкржЮрзНржЬрж┐ржХрж╛ ржХрзНржпрж╛рж▓рзЗржирзНржбрж╛рж░ ржжрзЗржЦрзБржи
  </section>

  <!-- 3) ЁЯМ╝ ржкрж░ржмрж░рзНрждрзА ржПржХрж╛ржжрж╢рзА -->
  <section class="panel eka">
    <div class="title">ЁЯМ╝ ржкрж░ржмрж░рзНрждрзА ржПржХрж╛ржжрж╢рзА</div>
    <div id="ekaName" class="name">тАФ</div>
    <div id="ekaMeta" class="meta">тАФ</div>
  </section>

  <!-- 4) ЁЯУг ржЖрж╕ржирзНржи ржЙрзОрж╕ржм -->
  <section class="panel fest">
    <div class="icon">ЁЯУг</div>
    <div id="festName" class="name">ржЧрзАрждрж╛ ржЬржпрж╝ржирзНрждрзА</div>
    <div id="festMeta" class="meta">тАФ</div>
  </section>

  <!-- 5) ЁЯМК ржЬрзЛржпрж╝рж╛рж░-ржнрж╛ржЯрж╛ -->
  <section class="panel tide">
    <div class="title">ЁЯМК ржЖржЬржХрзЗрж░ ржЬрзЛржпрж╝рж╛рж░-ржнрж╛ржЯрж╛</div>
    <div class="tide-grid">
      <div class="tide-cell"><div class="tide-row"><span class="tide-label">ржЙржЪрзНржЪ ржЬрзЛржпрж╝рж╛рж░ рзз</span><span id="th1" class="tide-val">тАФ</span></div></div>
      <div class="tide-cell"><div class="tide-row"><span class="tide-label">ржЙржЪрзНржЪ ржЬрзЛржпрж╝рж╛рж░ рзи</span><span id="th2" class="tide-val">тАФ</span></div></div>
      <div class="tide-cell"><div class="tide-row"><span class="tide-label">ржирж┐ржорзНржи ржнрж╛ржЯрж╛ рзз</span><span id="tl1" class="tide-val">тАФ</span></div></div>
      <div class="tide-cell"><div class="tide-row"><span class="tide-label">ржирж┐ржорзНржи ржнрж╛ржЯрж╛ рзи</span><span id="tl2" class="tide-val">тАФ</span></div></div>
    </div>
  </section>

<script>
(async function(){
  const base = location.origin.replace(/\/$/,'');
  try{
    const res = await fetch(base + '/api/panchika', { cache: 'no-store' });
    const d = await res.json();

    // ЁЯкФ Panchika
    setTxt('#tithi', d.tithi || 'тАФ');
    setTxt('#nakshatra', d.nakshatra || 'тАФ');
    setTxt('#sunrise', to12hBn(d.sunrise));
    setTxt('#sunset',  to12hBn(d.sunset));
    setTxt('#moonrise',to12hBn(d.moonrise));
    setTxt('#moonset', to12hBn(d.moonset));

    // ЁЯМ╝ Ekadashi тАФ name golden + Bengali numbers + bold dot + bold line-end
    const e = d.ekadashi || {};
    setTxt('#ekaName', e.name ? e.name : 'тАФ');
    const dateBn = e.date ? bnDate(e.date) : 'тАФ';
    const daysBn = (typeof e.days_left==='number') ? toBnDigits(String(e.days_left)) : 'тАФ';
    // dot bold + line bold
    document.querySelector('#ekaMeta').innerHTML =
      `${dateBn} <span class="dot">тАв</span> <b>${daysBn} ржжрж┐ржи ржмрж╛ржХрж┐</b>`;

    // ЁЯУг Festival demo (date + days in Bengali)
    const festDate = '2025-12-05';
    setTxt('#festName', 'ржЧрзАрждрж╛ ржЬржпрж╝ржирзНрждрзА');
    document.querySelector('#festMeta').innerHTML =
      `${bnDate(festDate)} <span class="dot">тАв</span> <b>${toBnDigits(daysLeft(festDate))} ржжрж┐ржи ржкрж░рзЗ</b>`;

    // ЁЯМК Tide (kept as is; when data wired, values will appear)
    const T = d.tide || [];
    setTxt('#th1', T[0]?.time || 'тАФ');
    setTxt('#th2', T[1]?.time || 'тАФ');
    setTxt('#tl1', T[2]?.time || 'тАФ');
    setTxt('#tl2', T[3]?.time || 'тАФ');
  }catch(err){ console.error(err); }

  // Popup trigger placeholder
  document.getElementById('calendarTrigger').addEventListener('click', ()=>{
    alert('Popup Calendar placeholder active (madhabam-fullcalendar).');
  });

  /* ---------- helpers ---------- */
  function setTxt(sel, v){ const el=document.querySelector(sel); if(el) el.textContent = v ?? 'тАФ'; }

  function to12hBn(isoLike){
    if(!isoLike) return 'тАФ';
    let d = new Date(isoLike);
    let H, M;
    if(String(d) === 'Invalid Date' && /^\d{2}:\d{2}/.test(isoLike)){
      [H,M] = isoLike.split(':').map(x=>parseInt(x,10));
    }else{
      H=d.getHours(); M=d.getMinutes();
    }
    const am = H < 12;
    let hr = H%12 || 12;
    const hh = hr.toString().padStart(2,'0');
    const mm = M.toString().padStart(2,'0');
    // ржмрж╛ржВрж▓рж╛ рж╕ржВржЦрзНржпрж╛ + AM/PM ржмрж╛ржВрж▓рж╛ржпрж╝
    const ap = am ? 'ржкрзВрж░рзНржмрж╛рж╣рзНржг' : 'ржЕржкрж░рж╛рж╣рзНржг';
    return `${toBnDigits(hh)}:${toBnDigits(mm)} ${ap}`;
  }

  function bnDate(dateStr){
    try{
      const d = new Date(dateStr+'T00:00:00');
      const opts = {year:'numeric',month:'long',day:'2-digit', timeZone:'Asia/Kolkata'};
      // ржмрж╛ржВрж▓рж╛ рж▓рзЛржХрзЗрж▓
      return new Intl.DateTimeFormat('bn-IN', opts).format(d);
    }catch{ return dateStr; }
  }

  function toBnDigits(str){
    const map = {'0':'рзж','1':'рзз','2':'рзи','3':'рзй','4':'рзк','5':'рзл','6':'рзм','7':'рзн','8':'рзо','9':'рзп'};
    return String(str).replace(/[0-9]/g, d => map[d]);
  }

  function daysLeft(dateStr){
    const now = new Date(); const d = new Date(dateStr+'T00:00:00');
    const n = Math.max(0, Math.ceil((d - now)/(1000*60*60*24)));
    return toBnDigits(n);
  }
})();
</script>
</body>
</html>
