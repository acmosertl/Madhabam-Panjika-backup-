<!-- ===== Part A: UI + CSS (Blogger-safe inline) ===== -->
<style>
:root{
  --bg:#fff4e3;
  --panel:#fff1dd;
  --card:#fff8ee;
  /* Variant 3 pink palette */
  --pink-bg:#fff0f6;
  --pink-1:#ffd7ea;
  --pink-2:#ffb3d9;
  --pink-3:#ff8ac3;
  --pink-4:#e85aa6;
  --label:#4527a0;
  --ink:#2b237c;
  --accent:#1565c0;
  --gold:#ffe8a6;
  --shadow:0 6px 18px rgba(16,10,20,.08);
  --radius:14px;
}

/* Reset + base */
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);font-family:"Noto Sans Bengali", system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial; color:var(--ink)}
.wrap{max-width:480px;margin:18px auto;padding:0}
.panel{background:var(--panel);border-radius:calc(var(--radius) - 4px);padding:8px;}

/* Card */
.card{background:var(--card);border-radius:var(--radius);padding:12px;margin:6px 4px;box-shadow:var(--shadow)}
.titleMain{font-weight:900;font-size:28px;text-align:center;margin:6px 2px 10px;color:var(--ink)}

/* Toggle block (centered header with sliding knob beneath segment labels) */
.toggleWrap{display:flex;flex-direction:column;align-items:center;gap:6px;margin:6px 8px}
.toggleHeader{display:flex;align-items:center;justify-content:center;width:100%;font-weight:800;color:var(--label);font-size:15px;padding:2px 6px}
.toggleBar{position:relative;display:flex;align-items:center;justify-content:space-between;
  background:linear-gradient(180deg,#fbf2d8,#f3e4b8);border-radius:999px;padding:10px 10px;width:92%;max-width:420px;box-shadow:inset 0 1px 0 rgba(255,255,255,.6)}
.toggleBar .seg{flex:1;text-align:center;font-weight:800;font-size:14px;color:var(--label);z-index:2;pointer-events:none}

/* slim slider knob that moves *below* the labels (visual: sits centered under the active label) */
.knob{
  position:absolute;
  top:calc(100% - 8px); /* sits below the labels */
  left:6%;
  width:32%;
  height:28px;
  transform:translateX(0);
  border-radius:999px;
  background:linear-gradient(90deg,var(--pink-2),var(--pink-3));
  box-shadow:0 6px 14px rgba(232,90,166,.18), inset 0 1px 0 rgba(255,255,255,.6);
  transition:transform .28s cubic-bezier(.2,.9,.2,1), left .28s ease;
  z-index:1;
  border:2px solid rgba(255,255,255,.5);
  opacity:0.98;
}
/* when active is right we will position knob to right using JS (class .pos-right) */
.knob.pos-right{ left:62%; transform:translateX(0); }

/* hint text below the toggle */
.toggleHint{font-size:12px;color:var(--label);font-weight:700;margin-top:0}

/* Pill / pink cards (variant 3 shades) */
.pill{background:var(--pink-1);border-radius:10px;padding:12px;margin:8px 0;border:1px solid rgba(0,0,0,0.03)}
.label{color:var(--label);font-weight:900;font-size:14px;margin-bottom:6px;display:block}
.value{font-weight:900;font-size:28px;line-height:1.08;color:var(--ink)}
.sub{font-size:13px;margin-top:8px;color:#2b237c}
.sub b{font-weight:900}
.paksha{display:block;width:max-content;margin:0 auto 8px auto;background:var(--gold);color:#6a5617;border-radius:999px;padding:6px 14px;font-weight:900;box-shadow:inset 0 -2px rgba(0,0,0,.02)}

/* time list */
.timeCol{display:flex;flex-direction:column;gap:10px;margin-top:8px}
.timeItem{background:linear-gradient(180deg,var(--pink-2),var(--pink-1));border-radius:10px;padding:12px;border:1px solid rgba(0,0,0,.03)}
.timeLab{color:var(--label);font-weight:900;font-size:14px;margin-bottom:6px}
.timeVal{font-weight:900;font-size:24px;line-height:1.05;color:var(--ink)}
.timeVal .ampm{font-size:18px;margin-left:6px;color:#333}

/* tide card */
.tide{background:linear-gradient(180deg,#183a8a,#0b2257);color:#fff;border-radius:12px;padding:12px;margin:6px 4px}
.thead{font-weight:900;text-align:center;margin-bottom:8px}
.tCol{display:flex;flex-direction:column;gap:8px}
.tc{background:rgba(255,255,255,.08);padding:10px;border-radius:10px}
.tLab{font-weight:800;margin-bottom:4px}
.tVal{font-weight:900;font-size:18px}
.badge{display:inline-block;margin-left:6px;padding:2px 8px;border-radius:999px;background:#eee;color:#444;font-size:11px;font-weight:800}
.badge.warn{background:#ffe1e1;color:#b00020}
.badge.ok{background:#e0ffe7;color:#0a7a2a}

/* location + clock footer */
.metaBox{background:linear-gradient(180deg,#fffaf0,#fff1dd);border-radius:10px;padding:10px;margin:8px 4px;text-align:center}
.metaBox .loc{font-weight:800;color:var(--ink)}
.metaClock{font-size:13px;color:#6a5617;margin-top:6px;font-weight:700}

/* Progress / Rashi bar (thicker + readable) */
.progWrap{background:#f3e0ef;border-radius:10px;padding:8px;margin-top:10px}
.progLabel{font-weight:800;color:var(--label);margin-bottom:6px}
.progBar{height:12px;border-radius:8px;background:#fff;box-shadow:inset 0 1px 0 rgba(0,0,0,.04);overflow:hidden}
.progFill{height:100%;border-radius:8px;background:linear-gradient(90deg,var(--pink-3),var(--pink-4));width:40%}
.progText{font-weight:800;margin-top:8px;color:var(--ink);font-size:13px}

/* responsive tweaks */
@media (max-width:420px){
  .knob{left:5%}
  .knob.pos-right{left:63%}
  .titleMain{font-size:24px}
  .value{font-size:24px}
}

/* small UI polish for boldness and contrast */
.card, .pill, .timeItem{font-weight:600}
.nextTag{color:var(--accent);font-weight:900}
</style>

<!-- Root: keep this exact id so existing JS (Part B) can target it -->
<div class="wrap">
  <div class="panel" id="root">
    <!-- Placeholder content ‚Äî JS (Part B) will replace this whole block when it runs -->
    <div style="text-align:center;padding:22px 0;font-weight:700">üìç ‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶® ‡¶®‡¶ø‡¶∞‡ßç‡¶ß‡¶æ‡¶∞‡¶£ ‡¶ï‡¶∞‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá...</div>
  </div>
</div>
<div id="root"></div>
<!-- ===== End Part A ===== -->

<script>
/* ============================================================
    MƒÄDHABAM PANJIKA ENGINE ‚Äî v7.4 (Surya/Drik Dual Mode)
    ‚úî Auto Refresh (1 hour)
    ‚úî Auto Rollover + Tithi/Nakshatra End Logic
    ‚úî Bangla Month from Surya Sankranti (Mesha‚ÄìMeena cycle)
    ‚úî Lagna + Chandra Rashi Progress Bar
    ‚úî Toggle Slider (below labels)
===============================================================*/

/* ---------------- Math Helpers ---------------- */
const D2R=Math.PI/180, R2D=180/Math.PI;
const norm=x=>((x%360)+360)%360;

function JD(y,m,d,ut=0){
  if(m<=2){y--;m+=12;}
  const A=Math.floor(y/100), B=2-A+Math.floor(A/4);
  return Math.floor(365.25*(y+4716))
       + Math.floor(30.6001*(m+1))
       + d + B - 1524.5 + ut/24;
}

function gmst(J){
  const T=(J-2451545)/36525;
  return norm(280.46061837 + 360.98564736629*(J-2451545)
       + 0.000387933*T*T - T*T*T/38710000);
}

function obliq(T){ return 23.439291 - 0.0130042*T; }

function eclToEq(l,J){
  const eps = obliq((J-2451545)/36525)*D2R;
  const L = l*D2R;
  return {
    ra: norm(Math.atan2(Math.sin(L)*Math.cos(eps),Math.cos(L))*R2D)/15,
    dec: Math.asin(Math.sin(eps)*Math.sin(L))*R2D
  };
}

function lstDeg(J,lon){ return (gmst(J) + lon) % 360; }

function altDeg(dec,ha,lat){
  return Math.asin(
    Math.sin(lat*D2R)*Math.sin(dec*D2R)
    + Math.cos(lat*D2R)*Math.cos(dec*D2R)*Math.cos(ha*D2R)
  )*R2D;
}

function fmt12(h){
  if(h==null || isNaN(h)) return "‚Äî";
  h=(h+24)%24;
  const ap=(h>=12?"PM":"AM");
  let hh=Math.floor(h%12); if(hh===0) hh=12;
  const mm=String(Math.round((h%1)*60)).padStart(2,"0");
  return `${hh}:${mm} <span class="ampm">${ap}</span>`;
}

const DAYS_BN=["‡¶∞‡¶¨‡¶ø‡¶¨‡¶æ‡¶∞","‡¶∏‡ßã‡¶Æ‡¶¨‡¶æ‡¶∞","‡¶Æ‡¶ô‡ßç‡¶ó‡¶≤‡¶¨‡¶æ‡¶∞","‡¶¨‡ßÅ‡¶ß‡¶¨‡¶æ‡¶∞","‡¶¨‡ßÉ‡¶π‡¶∏‡ßç‡¶™‡¶§‡¶ø‡¶¨‡¶æ‡¶∞","‡¶∂‡ßÅ‡¶ï‡ßç‡¶∞‡¶¨‡¶æ‡¶∞","‡¶∂‡¶®‡¶ø‡¶¨‡¶æ‡¶∞"];
function fmtDayTime(baseDate,localHour){
  const d=new Date(baseDate);
  const h=Math.floor(localHour);
  const m=Math.round((localHour%1)*60);
  d.setHours(0,0,0,0);
  d.setHours(d.getHours()+h,m);
  return `${DAYS_BN[d.getDay()]}, ${fmt12(localHour)}`;
}

/* ---------------- Sun + Moon Longitude ---------------- */
function sunLong(J){
  const d=J-2451545;
  const M=norm(357.52911 + 0.98560028*d);
  return norm(280.46646 + 0.98564736*d
         + 1.9146*Math.sin(M*D2R)
         + 0.02*Math.sin(2*M*D2R));
}

function moonLong(J){
  const d=J-2451545;
  const Lm=norm(218.3165+13.176358*d);
  const D =norm(297.8501921+12.19074912*d);
  const Ms=norm(357.5291092+0.98560028*d);
  const Mm=norm(134.9633964+13.06499295*d);
  return norm(Lm
    + 6.289*Math.sin(Mm*D2R)
    + 1.274*Math.sin((2*D-Mm)*D2R)
    + 0.658*Math.sin(2*D*D2R)
    - 0.186*Math.sin(Ms*D2R)
  );
}

/* ---------------- Mode: Surya vs Drik ---------------- */
const MODE_KEY="madhabam_mode_v7";
let MODE=localStorage.getItem(MODE_KEY) || "drik";
const setMode=m=>{ MODE=m; localStorage.setItem(MODE_KEY,m); };

function lahiriAyanamsa(J){
  const T=(J-2451545)/36525;
  return 24 + (50.290966/3600)*T*100;
}

const MODE_PARAMS={
  surya:{
    sun_h0:-0.833, moon_h0:+0.125,
    sun_corr:0.0, moon_corr:0.0,
    tithi_bias:0.0,
    ayan:(J)=>24
  },
  drik:{
    sun_h0:-0.833, moon_h0:+0.25,
    sun_corr:0.28, moon_corr:3.5,
    tithi_bias:0.25,
    ayan:lahiriAyanamsa
  }
};

/* ---------------- Rise/Set Raw ---------------- */
function solarRiseSetUTC_raw(J0,lat,lon,h0){
  let rise=null, setv=null;
  for(let k=0;k<24;k++){
    const a=J0+k/24, b=J0+(k+1)/24;
    const La=eclToEq(sunLong(a),a);
    const Lb=eclToEq(sunLong(b),b);
    const Ha=((lstDeg(a,lon)/15 - La.ra)*15 + 540)%360 - 180;
    const Hb=((lstDeg(b,lon)/15 - Lb.ra)*15 + 540)%360 - 180;
    const Aa=altDeg(La.dec,Ha,lat)-h0;
    const Ab=altDeg(Lb.dec,Hb,lat)-h0;

    if(Aa<0 && Ab>0 && rise===null){
      let lo=a, hi=b;
      for(let i=0;i<18;i++){
        const m=(lo+hi)/2;
        const L=eclToEq(sunLong(m),m);
        const H=((lstDeg(m,lon)/15 - L.ra)*15 + 540)%360 - 180;
        const A=altDeg(L.dec,H,lat)-h0;
        if(A<0) lo=m; else hi=m;
      }
      rise=((lo+hi)/2 - J0)*24;
    }

    if(Aa>0 && Ab<0 && setv===null){
      let lo=a, hi=b;
      for(let i=0;i<18;i++){
        const m=(lo+hi)/2;
        const L=eclToEq(sunLong(m),m);
        const H=((lstDeg(m,lon)/15 - L.ra)*15 + 540)%360 - 180;
        const A=altDeg(L.dec,H,lat)-h0;
        if(A>0) lo=m; else hi=m;
      }
      setv=((lo+hi)/2 - J0)*24;
    }
  }
  return {riseUTC:rise, setUTC:setv};
}

/* Moon Rise/Set ‚Äî Drik correction only */
function lunarRiseSetUTC_raw(J0,lat,lon,h0){
  let rise=null, setv=null;
  for(let k=0;k<48;k++){
    const a=J0+k/48, b=J0+(k+1)/48;
    const La=eclToEq(moonLong(a),a);
    const Lb=eclToEq(moonLong(b),b);
    const Ha=((lstDeg(a,lon)/15 - La.ra)*15 + 540)%360 - 180;
    const Hb=((lstDeg(b,lon)/15 - Lb.ra)*15 + 540)%360 - 180;
    const Aa=altDeg(La.dec,Ha,lat)-h0;
    const Ab=altDeg(Lb.dec,Hb,lat)-h0;

    if(Aa<0 && Ab>0 && rise===null){
      let lo=a, hi=b;
      for(let i=0;i<18;i++){
        const m=(lo+hi)/2;
        const L=eclToEq(moonLong(m),m);
        const H=((lstDeg(m,lon)/15 - L.ra)*15 + 540)%360 - 180;
        const A=altDeg(L.dec,H,lat)-h0;
        if(A<0) lo=m; else hi=m;
      }
      rise=((lo+hi)/2 - J0)*24;
    }

    if(Aa>0 && Ab<0 && setv===null){
      let lo=a, hi=b;
      for(let i=0;i<18;i++){
        const m=(lo+hi)/2;
        const L=eclToEq(moonLong(m),m);
        const H=((lstDeg(m,lon)/15 - L.ra)*15 + 540)%360 - 180;
        const A=altDeg(L.dec,H,lat)-h0;
        if(A>0) lo=m; else hi=m;
      }
      setv=((lo+hi)/2 - J0)*24;
    }
  }
  return {riseUTC:rise,setUTC:setv};
}

/* Apply fine tuning */
function solarRiseSetUTC(J0,lat,lon,h0,mode){
  const raw=solarRiseSetUTC_raw(J0,lat,lon,h0);
  const off=0.008; // approx 0.5 minute
  return {
    riseUTC:raw.riseUTC!=null?raw.riseUTC+off:null,
    setUTC: raw.setUTC !=null?raw.setUTC +off:null
  };
}
function lunarRiseSetUTC(J0,lat,lon,h0,mode){
  const raw=lunarRiseSetUTC_raw(J0,lat,lon,h0);
  const off=0.015;
  return {
    riseUTC:raw.riseUTC!=null?raw.riseUTC+off:null,
    setUTC: raw.setUTC !=null?raw.setUTC +off:null
  };
}

/* ---------------- Tithi / Nakshatra ---------------- */
function tithiInfo(J,mode){
  const p=MODE_PARAMS[mode];
  const ay=p.ayan(J);
  const ls = norm(sunLong(J)  - ay + p.sun_corr);
  const lm = norm(moonLong(J) - ay + p.moon_corr);
  const diff=norm(lm-ls + p.tithi_bias);
  const num=Math.floor(diff/12)+1;
  const paksha=(num<=15)?"‡¶∂‡ßÅ‡¶ï‡ßç‡¶≤‡¶™‡¶ï‡ßç‡¶∑":"‡¶ï‡ßÉ‡¶∑‡ßç‡¶£‡¶™‡¶ï‡ßç‡¶∑";
  return {num,paksha,angle:diff};
}

function tithiEndUTC(J0,mode){
  const cur=tithiInfo(J0,mode).num;
  let lo=J0, hi=J0+2;
  for(let i=0;i<40;i++){
    const m=(lo+hi)/2;
    if(tithiInfo(m,mode).num!==cur) hi=m;
    else lo=m;
  }
  return hi;
}

const NAK=[
"‡¶Ö‡¶∂‡ßç‡¶¨‡¶ø‡¶®‡ßÄ","‡¶≠‡¶∞‡¶£‡ßÄ","‡¶ï‡ßÉ‡¶§‡ßç‡¶§‡¶ø‡¶ï‡¶æ","‡¶∞‡ßã‡¶π‡¶ø‡¶£‡ßÄ","‡¶Æ‡ßÉ‡¶ó‡¶∂‡¶ø‡¶∞‡¶æ","‡¶Ü‡¶¶‡ßç‡¶∞‡¶æ","‡¶™‡ßÅ‡¶®‡¶∞‡ßç‡¶¨‡¶∏‡ßÇ","‡¶™‡ßÅ‡¶∑‡ßç‡¶Ø‡¶æ","‡¶Ü‡¶∂‡ßç‡¶≤‡ßá‡¶∑‡¶æ",
"‡¶Æ‡¶ò‡¶æ","‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶´‡¶æ‡¶≤‡ßç‡¶ó‡ßÅ‡¶®‡ßÄ","‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶´‡¶æ‡¶≤‡ßç‡¶ó‡ßÅ‡¶®‡ßÄ","‡¶π‡¶∏‡ßç‡¶§‡¶æ","‡¶ö‡¶ø‡¶§‡ßç‡¶∞‡¶æ","‡¶∏‡ßç‡¶¨‡¶æ‡¶§‡ßÄ","‡¶¨‡¶ø‡¶∂‡¶æ‡¶ñ‡¶æ","‡¶Ö‡¶®‡ßÅ‡¶∞‡¶æ‡¶ß‡¶æ",
"‡¶ú‡ßç‡¶Ø‡ßá‡¶∑‡ßç‡¶†‡¶æ","‡¶Æ‡ßÇ‡¶≤‡¶æ","‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶æ‡¶∑‡¶æ‡ßù‡¶æ","‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶æ‡¶∑‡¶æ‡ßù‡¶æ","‡¶∂‡ßç‡¶∞‡¶¨‡¶£‡¶æ","‡¶ß‡¶®‡¶ø‡¶∑‡ßç‡¶†‡¶æ","‡¶∂‡¶§‡¶≠‡¶ø‡¶∑‡¶æ","‡¶™‡ßÇ‡¶∞‡ßç‡¶¨‡¶≠‡¶æ‡¶¶‡ßç‡¶∞‡¶™‡¶¶",
"‡¶â‡¶§‡ßç‡¶§‡¶∞‡¶≠‡¶æ‡¶¶‡ßç‡¶∞‡¶™‡¶¶","‡¶∞‡ßá‡¶¨‡¶§‡ßÄ"
];

function siderealMoonLong(J,mode){
  const ay=MODE_PARAMS[mode].ayan(J);
  return norm(moonLong(J)-ay + MODE_PARAMS[mode].moon_corr);
}

function nakIdx(J,mode){ return Math.floor(siderealMoonLong(J,mode)/13.3333333)%27; }

function nakEndUTC(J0,mode){
  let cur=nakIdx(J0,mode);
  let lo=J0, hi=J0+1.2;
  while(nakIdx(hi,mode)===cur && (hi-J0)<2) hi+=0.1;
  if(nakIdx(hi,mode)===cur) hi=J0+2;
  for(let i=0;i<40;i++){
    const m=(lo+hi)/2;
    if(nakIdx(m,mode)!==cur) hi=m;
    else lo=m;
  }
  return hi;
}

/* ---------------- Bengali Month from Surya Sa·πÖkranti ---------------- */
const B_MONTHS=["‡¶¨‡ßà‡¶∂‡¶æ‡¶ñ","‡¶ú‡ßç‡¶Ø‡ßà‡¶∑‡ßç‡¶†","‡¶Ü‡¶∑‡¶æ‡ßù","‡¶∂‡ßç‡¶∞‡¶æ‡¶¨‡¶£","‡¶≠‡¶æ‡¶¶‡ßç‡¶∞","‡¶Ü‡¶∂‡ßç‡¶¨‡¶ø‡¶®","‡¶ï‡¶æ‡¶∞‡ßç‡¶§‡¶ø‡¶ï","‡¶Ö‡¶ó‡ßç‡¶∞‡¶π‡¶æ‡ßü‡¶£","‡¶™‡ßå‡¶∑","‡¶Æ‡¶æ‡¶ò","‡¶´‡¶æ‡¶≤‡ßç‡¶ó‡ßÅ‡¶®","‡¶ö‡ßà‡¶§‡ßç‡¶∞"];

function bangabdaFromSun(J, date){
  const thisYear=date.getFullYear();
  const by = (date >= new Date(thisYear,3,14))
            ? thisYear-593 : thisYear-594;

  const ay=MODE_PARAMS[MODE].ayan(J);
  const lon=norm(sunLong(J)-ay);
  const sign=Math.floor(lon/30);
  const day=Math.floor(lon%30)+1;

  return {month:B_MONTHS[sign], day, year:by};
}

/* ---------------- Lagna (Sun position) ---------------- */
function getLagna(J,mode){
  const ay=MODE_PARAMS[mode].ayan(J);
  const lon=norm(sunLong(J)-ay);
  const sign=Math.floor(lon/30);
  const degree=lon%30;
  return {sign, degree};
}

/* ---------------- Moon Rashi + Progress bar ---------------- */
function getMoonRashi(J,mode){
  const ay=MODE_PARAMS[mode].ayan(J);
  const lon=norm(moonLong(J)-ay);
  const sign=Math.floor(lon/30);
  const degree=lon%30;
  const progress=(degree/30)*100;
  return {sign,degree,progress};
}

/* ---------------- Location Resolver ---------------- */
const FALLBACK={lat:22.5726,lon:88.3639,place:"Kolkata, India",city:"Kolkata",label:"Fallback"};

async function getLocation(){
  // GPS first
  if(navigator.geolocation){
    const gps = await new Promise(res=>{
      navigator.geolocation.getCurrentPosition(
        p=>res({lat:p.coords.latitude,lon:p.coords.longitude,label:"GPS",place:"GPS"}),
        ()=>res(null),
        {timeout:3000}
      );
    });
    if(gps) return gps;
  }

  // IP
  try{
    const r=await fetch("https://ipapi.co/json/");
    const j=await r.json();
    if(j && j.latitude) return {
      lat:j.latitude,lon:j.longitude,place:j.city+", "+j.country, label:"IP"
    };
  }catch{}

  return FALLBACK;
}

/* ---------------- Render Engine ---------------- */
(async function init(){

  const loc=await getLocation();
  const {lat,lon,place,label}=loc;

  const now=new Date();
  const Y=now.getFullYear(), M=now.getMonth()+1, D=now.getDate();
  const J0UTC=JD(Y,M,D,0);

  // Solar rise boundary
  const sUTC0=solarRiseSetUTC(J0UTC,lat,lon,MODE_PARAMS[MODE].sun_h0,MODE);
  const srLocal=(sUTC0.riseUTC!=null)?sUTC0.riseUTC:6;
  const localHr=now.getHours()+now.getMinutes()/60;
  const JdayUTC = (localHr<srLocal)?(J0UTC-1):J0UTC;

  // Evaluate at noon
  const JE = JdayUTC + 0.5;

  /* Tithi / Nakshatra */
  const tNow=tithiInfo(JE,MODE);
  const tEnd=tithiEndUTC(JE,MODE);
  const nIdxNow=nakIdx(JE,MODE);
  const nEnd=nakEndUTC(JE,MODE);

  const tNext=(tNow.num%30)+1;
  const nNext=(nIdxNow+1)%27;

  /* Rise/Set */
  const sEv=solarRiseSetUTC(JdayUTC,lat,lon,MODE_PARAMS[MODE].sun_h0,MODE);
  const mEv=lunarRiseSetUTC(JdayUTC,lat,lon,MODE_PARAMS[MODE].moon_h0,MODE);

  /* Bangla Month */
  const bang=bangabdaFromSun(JE,now);

  /* Lagna / Rashi */
  const lag=getLagna(JE,MODE);
  const moonR=getMoonRashi(JE,MODE);

  const lagNames=["‡¶Æ‡ßá‡¶∑","‡¶¨‡ßÉ‡¶∑","‡¶Æ‡¶ø‡¶•‡ßÅ‡¶®","‡¶ï‡¶∞‡ßç‡¶ï‡¶ü","‡¶∏‡¶ø‡¶Ç‡¶π","‡¶ï‡¶®‡ßç‡¶Ø‡¶æ","‡¶§‡ßÅ‡¶≤‡¶æ","‡¶¨‡ßÉ‡¶∂‡ßç‡¶ö‡¶ø‡¶ï","‡¶ß‡¶®‡ßÅ","‡¶Æ‡¶ï‡¶∞","‡¶ï‡ßÅ‡¶Æ‡ßç‡¶≠","‡¶Æ‡ßÄ‡¶®"];
  const rashiNames=lagNames;

  /* Paksha Emoji */
  const pakEmoji = (tNow.paksha==="‡¶∂‡ßÅ‡¶ï‡ßç‡¶≤‡¶™‡¶ï‡ßç‡¶∑")
    ? "üåí" : "üåñ";

  /* Toggle active class */
  const knobClass = (MODE==="drik") ? "knob pos-right" : "knob";

  /* Render HTML */
  document.getElementById("root").innerHTML = `
  <div class="titleMain">‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶™‡¶û‡ßç‡¶ú‡¶ø‡¶ï‡¶æ</div>

  <div class="toggleWrap">
      <div class="toggleHeader">‡¶™‡¶û‡ßç‡¶ú‡¶ø‡¶ï‡¶æ ‡¶®‡¶ø‡¶∞‡ßç‡¶¨‡¶æ‡¶ö‡¶®</div>
      <div class="toggleBar" id="toggleBar">
        <div class="seg">‡¶∏‡ßÇ‡¶∞‡ßç‡¶Ø‡¶∏‡¶ø‡¶¶‡ßç‡¶ß‡¶æ‡¶®‡ßç‡¶§</div>
        <div class="seg">‡¶¶‡ßÉ‡¶ï (Govt)</div>
        <div class="${knobClass}" id="knob"></div>
      </div>
      <div class="toggleHint">‡¶ü‡ßç‡¶Ø‡¶æ‡¶™ ‡¶ï‡¶∞‡ßá ‡¶™‡¶û‡ßç‡¶ú‡¶ø‡¶ï‡¶æ ‡¶™‡¶∞‡¶ø‡¶¨‡¶∞‡ßç‡¶§‡¶® ‡¶ï‡¶∞‡ßÅ‡¶®</div>
  </div>

  <div class="pill">
      <span class="paksha">${pakEmoji} ${tNow.paksha}</span>
      <div class="label">‡¶§‡¶ø‡¶•‡¶ø</div>
      <div class="value">${tithiName(tNow.num)}</div>
      <div class="sub"><b>‡¶∂‡ßá‡¶∑:</b> ${fmtDayTime(now,(tEnd-JdayUTC)*24)}
      ¬∑ <b>‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ:</b> <span class="nextTag">${tithiName(tNext)}</span></div>
  </div>

  <div class="pill">
      <div class="label">‡¶®‡¶ï‡ßç‡¶∑‡¶§‡ßç‡¶∞</div>
      <div class="value">${NAK[nIdxNow]}</div>
      <div class="sub"><b>‡¶∂‡ßá‡¶∑:</b> ${fmtDayTime(now,(nEnd-JdayUTC)*24)}
      ¬∑ <b>‡¶™‡¶∞‡¶¨‡¶∞‡ßç‡¶§‡ßÄ:</b> <span class="nextTag">${NAK[nNext]}</span></div>
  </div>

  <div class="pill">
      <div class="label">‡¶≤‡¶ó‡ßç‡¶®</div>
      <div class="value">${lagNames[lag.sign]}</div>
      <div class="sub">‡¶°‡¶ø‡¶ó‡ßç‡¶∞‡¶ø: ${lag.degree.toFixed(2)}¬∞</div>
  </div>

  <div class="pill">
      <div class="label">‡¶∞‡¶æ‡¶∂‡¶ø (‡¶ö‡¶æ‡¶Å‡¶¶)</div>
      <div class="value">${rashiNames[moonR.sign]}</div>

      <div class="progWrap">
         <div class="progLabel">‡¶Ö‡¶¨‡¶∏‡ßç‡¶•‡¶æ‡¶® (‡¶∞‡¶æ‡¶∂‡¶ø‡¶∞ ‡ß© ‡¶≠‡¶æ‡¶ó‡ßá‡¶∞ ‡¶Æ‡¶ß‡ßç‡¶Ø‡ßá)</div>
         <div class="progBar"><div class="progFill" style="width:${moonR.progress}%"></div></div>
         <div class="progText">‡¶™‡ßç‡¶∞‡¶ó‡¶§‡¶ø: ${moonR.progress.toFixed(1)}%</div>
      </div>
  </div>

  <div class="timeCol">
      <div class="timeItem">
        <div class="timeLab">‡¶∏‡ßÇ‡¶∞‡ßç‡¶Ø‡ßã‡¶¶‡¶Ø‡¶º</div>
        <div class="timeVal">${fmt12(sEv.riseUTC)}</div>
      </div>
      <div class="timeItem">
        <div class="timeLab">‡¶∏‡ßÇ‡¶∞‡ßç‡¶Ø‡¶æ‡¶∏‡ßç‡¶§</div>
        <div class="timeVal">${fmt12(sEv.setUTC)}</div>
      </div>
  </div>

  <div class="metaBox">
      <div class="loc">üìç ${place} (${label})</div>
      <div class="loc">${bang.day} ${bang.month} ${bang.year} ‡¶¨‡¶ô‡ßç‡¶ó‡¶æ‡¶¨‡ßç‡¶¶</div>
  </div>

  <div class="metaClock">Auto refresh: ‡¶™‡ßç‡¶∞‡¶§‡¶ø ‡ß¨‡ß¶ ‡¶Æ‡¶ø‡¶®‡¶ø‡¶ü ¬∑ ‡¶™‡¶û‡ßç‡¶ú‡¶ø‡¶ï‡¶æ: ${MODE==="drik"?"‡¶¶‡ßÉ‡¶ï":"‡¶∏‡ßÇ‡¶∞‡ßç‡¶Ø‡¶∏‡¶ø‡¶¶‡ßç‡¶ß‡¶æ‡¶®‡ßç‡¶§"}</div>
  `;

  /* Toggle listener */
  document.getElementById("toggleBar").onclick=()=>{
    setMode(MODE==="drik"?"surya":"drik");
    location.reload();
  };

  /* Auto refresh every 1 hour */
  setTimeout(()=>location.reload(), 1000*60*60);
})();
      </script>
